package sia.com.learn;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.app.ActivityCompat;

import android.Manifest;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.os.Build;
import android.os.Bundle;
import android.util.TypedValue;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.widget.GridView;
import android.widget.Toast;

import java.util.List;

public class MainActivity extends AppCompatActivity {

    private static final int PERM_REQ_CODE = 123;
    GridView gridView;
    int columnWidth;
    Utils utils;
    imageAdapter imageAdapter2;
    myLittleGallery mygallery = new myLittleGallery();
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        gridView = findViewById(R.id.gridview);
        initGridVIEW();
        utils = new Utils(this);
        if (checkperm()){
            loadfiles();
        }
    }
    //my codes
    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        MenuInflater inflater = getMenuInflater();
        inflater.inflate(R.menu.menu, menu);
        return true;

    }
    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        if (item.getItemId() == R.id.i2){
            Intent intent = new Intent(MainActivity.this , myLittleGallery.class);
            startActivity(intent);
        }
        if (item.getItemId() == R.id.i1){
            Intent intent2 = new Intent(MainActivity.this , MainLearn.class );
            startActivity(intent2);
        }
        if (item.getItemId() == R.id.i3){
            Intent intent3 = new Intent(MainActivity.this , Videoplayer.class);
            startActivity(intent3);
        }
        return super.onOptionsItemSelected(item);

    }
//end my code
    public void loadfiles() {
        List<String> kir = utils.getfilepaths();
      //  List<String> kir = mygallery.display();
        imageAdapter2 = new imageAdapter(this , kir , columnWidth);
        gridView.setAdapter(imageAdapter2);
        }

    //meghdar dehi avalieh be grid view

    public void initGridVIEW() {
        float padding = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP , AppConfig.PADDING, getResources().getDisplayMetrics());

        columnWidth = (int) (utils.getScreenWidth() - (AppConfig.COLUM_COUNT +  1) * padding) / AppConfig.COLUM_COUNT;

        gridView.setNumColumns(AppConfig.COLUM_COUNT);
        gridView.setStretchMode(GridView.NO_STRETCH);
        gridView.setColumnWidth(columnWidth);
        gridView.setPadding((int) padding , (int) padding, (int) padding,(int) padding);
        gridView.setHorizontalSpacing((int) padding);
        gridView.setVerticalSpacing((int) padding);
    }
    private boolean checkperm() {

        if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.LOLLIPOP_MR1){
            return true;
        }
        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.READ_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED){
            ActivityCompat.requestPermissions(this , new String[]{Manifest.permission.READ_EXTERNAL_STORAGE},PERM_REQ_CODE);return false;
        }return true;
    }

    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
        if (requestCode == PERM_REQ_CODE){
            if (grantResults[0] == PackageManager.PERMISSION_GRANTED){
                Toast.makeText(this , "permisson granted" , Toast.LENGTH_SHORT).show();
                loadfiles();


            }else {
                Toast.makeText(this , "permisson denied" , Toast.LENGTH_LONG).show();
            }
        }
    }
}
